"use strict";(self.webpackChunkcontabo_docs=self.webpackChunkcontabo_docs||[]).push([[1362],{3905:(e,t,o)=>{o.d(t,{Zo:()=>u,kt:()=>m});var r=o(7294);function a(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function n(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function i(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?n(Object(o),!0).forEach((function(t){a(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function l(e,t){if(null==e)return{};var o,r,a=function(e,t){if(null==e)return{};var o,r,a={},n=Object.keys(e);for(r=0;r<n.length;r++)o=n[r],t.indexOf(o)>=0||(a[o]=e[o]);return a}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++)o=n[r],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}var s=r.createContext({}),c=function(e){var t=r.useContext(s),o=t;return e&&(o="function"==typeof e?e(t):i(i({},t),e)),o},u=function(e){var t=c(e.components);return r.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var o=e.components,a=e.mdxType,n=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=c(o),m=a,h=d["".concat(s,".").concat(m)]||d[m]||p[m]||n;return o?r.createElement(h,i(i({ref:t},u),{},{components:o})):r.createElement(h,i({ref:t},u))}));function m(e,t){var o=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var n=o.length,i=new Array(n);i[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var c=2;c<n;c++)i[c]=o[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,o)}d.displayName="MDXCreateElement"},8810:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>p,frontMatter:()=>n,metadata:()=>l,toc:()=>c});var r=o(7462),a=(o(7294),o(3905));const n={title:"Setup Custom Domain",sidebar_position:11},i="Setting Up a Custom Domain",l={unversionedId:"products/Object-Storage/HowTo/custom-domain",id:"products/Object-Storage/HowTo/custom-domain",title:"Setup Custom Domain",description:"Sometimes you might want to use your own custom domain name instead of the rather generic ones provided by default for your S3 compatible Object Storage. The S3 Object Storage is available only via TLS encrypted transport (https) in order to improve security. CNAME resource records only work with unencrytped transport and are not supported without showing up certificate errors.",source:"@site/docs/products/Object-Storage/HowTo/custom-domain.md",sourceDirName:"products/Object-Storage/HowTo",slug:"/products/Object-Storage/HowTo/custom-domain",permalink:"/docs/products/Object-Storage/HowTo/custom-domain",draft:!1,editUrl:"https://github.com/contabo/docs/tree/main/docs/products/Object-Storage/HowTo/custom-domain.md",tags:[],version:"current",sidebarPosition:11,frontMatter:{title:"Setup Custom Domain",sidebar_position:11},sidebar:"productSidebar",previous:{title:"Control Storage Space",permalink:"/docs/products/Object-Storage/HowTo/control-storage-space"},next:{title:"Using S3 Object Storage programatically",permalink:"/docs/products/Object-Storage/HowTo/programming"}},s={},c=[{value:"Cloudflare Example",id:"cloudflare-example",level:2},{value:"Prepare Bucket",id:"prepare-bucket",level:3},{value:"DNS",id:"dns",level:3},{value:"SSL Mode",id:"ssl-mode",level:3},{value:"Rewrite URL",id:"rewrite-url",level:3}],u={toc:c};function p(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"setting-up-a-custom-domain"},"Setting Up a Custom Domain"),(0,a.kt)("p",null,"Sometimes you might want to use your own custom domain name instead of the rather generic ones provided by default for your S3 compatible Object Storage. The S3 Object Storage is available only via TLS encrypted transport (",(0,a.kt)("inlineCode",{parentName:"p"},"https"),") in order to improve security. ",(0,a.kt)("inlineCode",{parentName:"p"},"CNAME")," resource records only work with unencrytped transport and are not supported without showing up certificate errors."),(0,a.kt)("p",null,"Bascially, you'll need to set up a proxy server passing the requests to the S3 Object Storage system and als providing the TLS certificate. You could, for example, use Cloudflare. Please be cautious setting up such a proxy, so that it doesn't change the requests."),(0,a.kt)("h2",{id:"cloudflare-example"},"Cloudflare Example"),(0,a.kt)("admonition",{title:"Prerequisites",type:"info"},(0,a.kt)("p",{parentName:"admonition"},"This guide assumes that you already have a domain on ",(0,a.kt)("a",{parentName:"p",href:"https://www.cloudflare.com/"},"Cloudflare"),"."),(0,a.kt)("p",{parentName:"admonition"},"This only works for publicly shared objects. See: ",(0,a.kt)("a",{parentName:"p",href:"/docs/products/Object-Storage/Tutorial/shareWithPublic"},"Share Object Storage with public"))),(0,a.kt)("p",null,"Cloudflare makes it easy to get a bucket publicly accessible on your own domain name."),(0,a.kt)("h3",{id:"prepare-bucket"},"Prepare Bucket"),(0,a.kt)("p",null,"First, make sure you have created the bucket and enabled public sharing for the bucket the Contabo Object Storage Panel. Note: When public sharing is enabled for a bucket, all objects inside the first level of the bucket are also automatically publicly shared (even when not shared explicitly). However, this is not true for objects in folders inside the bucket. Enable public sharing for each folder as well if you want their content to be also publicly accessible."),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"Take note of the public sharing URL. It contains your unique tenant ID which we will need later. The URL looks like this, for example: ",(0,a.kt)("a",{parentName:"p",href:"https://eu2.contabostorage.com/5b5de0931f634e9096479dbc6e65b207:bucket"},"https://eu2.contabostorage.com/5b5de0931f634e9096479dbc6e65b207:bucket"))),(0,a.kt)("h3",{id:"dns"},"DNS"),(0,a.kt)("p",null,"Once you are set, sign into the ",(0,a.kt)("a",{parentName:"p",href:"https://dash.cloudflare.com/"},"Cloudflare Dashboard")," and select your domain. Go to the DNS panel first and select ",(0,a.kt)("em",{parentName:"p"},"Add record"),". Choose ",(0,a.kt)("em",{parentName:"p"},"CNAME"),' as type, enter a name of your choice ("objects" in this example) and enter the target. This is the first part of the public sharing URL ("eu2.contabostorage.com" here).'),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Cloudflare DNS Add record",src:o(952).Z,width:"2044",height:"569"})),(0,a.kt)("p",null,"The final DNS record should look like this:"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Cloudflare DNS CNAME",src:o(2995).Z,width:"2880",height:"1566"})),(0,a.kt)("h3",{id:"ssl-mode"},"SSL Mode"),(0,a.kt)("p",null,"To avoid infinite redirects, set the SSL mode in Cloudflare. Go to Rules ","\u2192"," Configuration Rules in the Cloudflare Dashboard and select ",(0,a.kt)("em",{parentName:"p"},"Create rule"),'. There, select "Hostname" as ',(0,a.kt)("em",{parentName:"p"},"Field"),', "equals" as ',(0,a.kt)("em",{parentName:"p"},"Operator")," and your hostname as ",(0,a.kt)("em",{parentName:"p"},"Value"),', "objects.example.com" in our example:'),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Cloudflare Configuration Rule",src:o(9873).Z,width:"2880",height:"1566"})),(0,a.kt)("p",null,'Scroll down to add SSL as setting and set it to "Full":'),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Cloudflare Configuration Rule SSL",src:o(5802).Z,width:"2360",height:"607"})),(0,a.kt)("h3",{id:"rewrite-url"},"Rewrite URL"),(0,a.kt)("p",null,"Next up is a rewrite rule to shorten the final URL. Go to Rules ","\u2192"," Transform Rules in the Cloudflare Dashboard, select ",(0,a.kt)("em",{parentName:"p"},"Create transform rule")," and ",(0,a.kt)("em",{parentName:"p"},"Rewrite URL"),":"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Cloudflare Create transform rule",src:o(5389).Z,width:"2880",height:"1566"})),(0,a.kt)("p",null,'We set the rule to match all requests for the newly-added hostname so select "Hostname" as ',(0,a.kt)("em",{parentName:"p"},"Field"),', "equals" as ',(0,a.kt)("em",{parentName:"p"},"Operator")," and your hostname as ",(0,a.kt)("em",{parentName:"p"},"Value"),', "objects.example.com" in our example.'),(0,a.kt)("p",null,"Select ",(0,a.kt)("em",{parentName:"p"},"Rewrite to...")," as ",(0,a.kt)("em",{parentName:"p"},"Then..."),' action, make sure it is set to "Dynamic" and enter this pattern:'),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'concat("/<your unique tenant ID>:<bucket>",http.request.uri.path)\n')),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Cloudflare URL Rewrite",src:o(2383).Z,width:"2880",height:"1566"})),(0,a.kt)("p",null,"With this rewrite rule, we won't need to put the tenant ID and bucket name in the URL anymore. Cloudflare will do it for us when proxying the request to the Object Storage. With this, we went from the long original URL ",(0,a.kt)("inlineCode",{parentName:"p"},"https://eu2.contabostorage.com/5b5de0931f634e9096479dbc6e65b207:bucket/image.jpg")," to a much shorter: ",(0,a.kt)("inlineCode",{parentName:"p"},"https://objects.example.com/image.jpg")))}p.isMDXComponent=!0},9873:(e,t,o)=>{o.d(t,{Z:()=>r});const r=o.p+"assets/images/Cloudflare_Configuration_Rule-59a5c5889fee32178e1f99d49343fdd6.png"},5802:(e,t,o)=>{o.d(t,{Z:()=>r});const r=o.p+"assets/images/Cloudflare_Configuration_Rule_SSL-479163a533f2fc3909d0ee39188f779e.png"},5389:(e,t,o)=>{o.d(t,{Z:()=>r});const r=o.p+"assets/images/Cloudflare_Create_transform_rule-a229a85ad3cbb505870e540c350be11d.png"},952:(e,t,o)=>{o.d(t,{Z:()=>r});const r=o.p+"assets/images/Cloudflare_DNS_Add_record-95b4b95ada06c5693f3244716f49423c.png"},2995:(e,t,o)=>{o.d(t,{Z:()=>r});const r=o.p+"assets/images/Cloudflare_DNS_CNAME-942c057b02505c83d7f9422ce09af652.png"},2383:(e,t,o)=>{o.d(t,{Z:()=>r});const r=o.p+"assets/images/Cloudflare_URL_Rewrite-54f4fab24e1ac1e04046f9a894e2aecb.png"}}]);