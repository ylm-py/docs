"use strict";(self.webpackChunkcontabo_docs=self.webpackChunkcontabo_docs||[]).push([[1240],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),c=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},b=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,l=e.originalType,s=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),b=c(n),m=o,d=b["".concat(s,".").concat(m)]||b[m]||u[m]||l;return n?a.createElement(d,r(r({ref:t},p),{},{components:n})):a.createElement(d,r({ref:t},p))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var l=n.length,r=new Array(l);r[0]=b;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:o,r[1]=i;for(var c=2;c<l;c++)r[c]=n[c];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}b.displayName="MDXCreateElement"},5861:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>u,frontMatter:()=>l,metadata:()=>i,toc:()=>c});var a=n(7462),o=(n(7294),n(3905));const l={title:"Automate Public Sharing",sidebar_position:4},r="Automate Public Sharing via S3 API",i={unversionedId:"products/Object-Storage/HowTo/public-sharing",id:"products/Object-Storage/HowTo/public-sharing",title:"Automate Public Sharing",description:"This How-To is for those who do want to do public sharing of files by automation tools. This might not be the only way, but the one also used by Contabo's Object Storage Panel. This relies on so called policies.",source:"@site/docs/products/Object-Storage/HowTo/public-sharing.md",sourceDirName:"products/Object-Storage/HowTo",slug:"/products/Object-Storage/HowTo/public-sharing",permalink:"/docs/products/Object-Storage/HowTo/public-sharing",draft:!1,editUrl:"https://github.com/contabo/docs/tree/main/docs/products/Object-Storage/HowTo/public-sharing.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{title:"Automate Public Sharing",sidebar_position:4},sidebar:"productSidebar",previous:{title:"Pre-signed URL",permalink:"/docs/products/Object-Storage/HowTo/presigned-url"},next:{title:"Simple Backup",permalink:"/docs/products/Object-Storage/HowTo/simple-backup"}},s={},c=[{value:"Setup your S3 tool",id:"setup-your-s3-tool",level:2},{value:"Enable Public Sharing for a file",id:"enable-public-sharing-for-a-file",level:2},{value:"Example for Enabling",id:"example-for-enabling",level:3},{value:"Example values",id:"example-values",level:4},{value:"Enable Public Sharing for a folder an all its sub items",id:"enable-public-sharing-for-a-folder-an-all-its-sub-items",level:2},{value:"Example for Enabling",id:"example-for-enabling-1",level:3},{value:"Example values",id:"example-values-1",level:4},{value:"Disable Public Sharing",id:"disable-public-sharing",level:2}],p={toc:c};function u(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"automate-public-sharing-via-s3-api"},"Automate Public Sharing via S3 API"),(0,o.kt)("p",null,"This How-To is for those who do want to do public sharing of files by automation tools. This might not be the only way, but the one also used by Contabo's Object Storage Panel. This relies on so called ",(0,o.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/AmazonS3/latest/userguide/bucket-policies.html"},"policies"),"."),(0,o.kt)("h2",{id:"setup-your-s3-tool"},"Setup your S3 tool"),(0,o.kt)("p",null,"The easiest way is to use ",(0,o.kt)("a",{parentName:"p",href:"/docs/products/Object-Storage/Tools/aws-cli"},"aws cli"),". Please make sure to have it installes and configured properly."),(0,o.kt)("h2",{id:"enable-public-sharing-for-a-file"},"Enable Public Sharing for a file"),(0,o.kt)("p",null,"Create a file ",(0,o.kt)("inlineCode",{parentName:"p"},"public-sharing-policy.json")," with following content"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="public-sharing-policy.json"',title:'"public-sharing-policy.json"'},'{\n  "Id": "your-fancy-name",\n  "Version": "2012-10-17",\n  "Statement": [\n    {\n      "Action": [\n        "s3:GetObject"\n      ],\n      "Effect": "Allow",\n      "Resource": [\n        "arn:aws:s3:::foldername/file"\n      ],\n      "Principal": "*"\n    }\n  ]\n}\n')),(0,o.kt)("p",null,"This basically allows (",(0,o.kt)("inlineCode",{parentName:"p"},"Effect"),") reading Objects (",(0,o.kt)("inlineCode",{parentName:"p"},"s3:GetObject"),") by everyone (",(0,o.kt)("inlineCode",{parentName:"p"},"Principal"),") for the specified file (",(0,o.kt)("inlineCode",{parentName:"p"},"Resource"),")."),(0,o.kt)("h3",{id:"example-for-enabling"},"Example for Enabling"),(0,o.kt)("h4",{id:"example-values"},"Example values"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"S3 URL = ",(0,o.kt)("a",{parentName:"li",href:"https://eu2.contabostorage.com"},"https://eu2.contabostorage.com")),(0,o.kt)("li",{parentName:"ul"},"Bucket = foo"),(0,o.kt)("li",{parentName:"ul"},"File to share = foo/test.jpg"),(0,o.kt)("li",{parentName:"ul"},"Policy file = public-sharing-policy.json with following contents")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="public-sharing-policy.json"',title:'"public-sharing-policy.json"'},'{\n  "Id": "public-share-example-test",\n  "Version": "2012-10-17",\n  "Statement": [\n    {\n      "Action": [\n        "s3:GetObject"\n      ],\n      "Effect": "Allow",\n      "Resource": [\n        "arn:aws:s3:::foo/test.png"\n      ],\n      "Principal": "*"\n    }\n  ]\n}\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"aws --profile eu2 --endpoint-url https://eu2.contabostorage.com s3api put-bucket-policy --bucket foo --policy file://public-sharing-policy.json\n")),(0,o.kt)("p",null,"The URL would be ",(0,o.kt)("a",{parentName:"p",href:"https://eu2.contabostorage.com/%7Bs3TenantId%7D:foo/test.png"},"https://eu2.contabostorage.com/{s3TenantId}:foo/test.png"),". The ",(0,o.kt)("inlineCode",{parentName:"p"},"s3TenantId")," can be retrieved via the ",(0,o.kt)("a",{parentName:"p",href:"https://api.contabo.com/#operation/retrieveObjectStorageList"},"Contabo API"),"."),(0,o.kt)("h2",{id:"enable-public-sharing-for-a-folder-an-all-its-sub-items"},"Enable Public Sharing for a folder an all its sub items"),(0,o.kt)("p",null,"Create a file ",(0,o.kt)("inlineCode",{parentName:"p"},"public-sharing-policy.json")," with following content"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="public-sharing-policy.json"',title:'"public-sharing-policy.json"'},'{\n  "Id": "your-fancy-name",\n  "Version": "2012-10-17",\n  "Statement": [\n    {\n      "Action": [\n        "s3:GetObject"\n      ],\n      "Effect": "Allow",\n      "Resource": [\n        "arn:aws:s3:::foldername/*"\n      ],\n      "Principal": "*"\n    }\n  ]\n}\n')),(0,o.kt)("p",null,"The only difference is that you put ",(0,o.kt)("inlineCode",{parentName:"p"},"*")," as a wildcard / placeholder for the file name. Of course you can have constucts like ",(0,o.kt)("inlineCode",{parentName:"p"},'"arn:aws:s3:::foldername1/foldername2/*"')),(0,o.kt)("h3",{id:"example-for-enabling-1"},"Example for Enabling"),(0,o.kt)("h4",{id:"example-values-1"},"Example values"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"S3 URL = ",(0,o.kt)("a",{parentName:"li",href:"https://eu2.contabostorage.com"},"https://eu2.contabostorage.com")),(0,o.kt)("li",{parentName:"ul"},"Bucket = foo"),(0,o.kt)("li",{parentName:"ul"},"Folder to share = foo/*"),(0,o.kt)("li",{parentName:"ul"},"Policy file = public-sharing-policy.json with following contents")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="public-sharing-policy.json"',title:'"public-sharing-policy.json"'},'{\n  "Id": "public-share-example-test",\n  "Version": "2012-10-17",\n  "Statement": [\n    {\n      "Action": [\n        "s3:GetObject"\n      ],\n      "Effect": "Allow",\n      "Resource": [\n        "arn:aws:s3:::foo/*"\n      ],\n      "Principal": "*"\n    }\n  ]\n}\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"aws --profile eu2 --endpoint-url https://eu2.contabostorage.com s3api put-bucket-policy --bucket foo --policy file://public-sharing-policy.json\n")),(0,o.kt)("p",null,"Please be aware that the S3 Object Storage doesn't support file listing in browser (please refer to ",(0,o.kt)("a",{parentName:"p",href:"/docs/products/Object-Storage/Tutorial/shareWithPublic#peculiarity-for-sharing-folders"},"tutorial"),")"),(0,o.kt)("p",null,"The URL would be ",(0,o.kt)("a",{parentName:"p",href:"https://eu2.contabostorage.com/%7Bs3TenantId%7D:foo/bar/filename.ending"},"https://eu2.contabostorage.com/{s3TenantId}:foo/bar/filename.ending"),". The ",(0,o.kt)("inlineCode",{parentName:"p"},"s3TenantId")," can be retrieved via the ",(0,o.kt)("a",{parentName:"p",href:"https://api.contabo.com/#operation/retrieveObjectStorageList"},"Contabo API"),"."),(0,o.kt)("h2",{id:"disable-public-sharing"},"Disable Public Sharing"),(0,o.kt)("p",null,"To disable the Public Sharing for a file or folder you need first to get the current policy via"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"aws --profile eu2 --endpoint-url https://eu2.contabostorage.com s3api get-bucket-policy --bucket foo\n")),(0,o.kt)("p",null,"Then remove the parts you would like to remove and do the ",(0,o.kt)("inlineCode",{parentName:"p"},"put-bucket-policy")," again with the modified file. If it is the last entry in there you could also delete it completely via"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"aws --profile eu2 --endpoint-url https://eu2.contabostorage.com s3api delete-bucket-policy --bucket foo\n")),(0,o.kt)("p",null,"But be cautious as this will delete ",(0,o.kt)("strong",{parentName:"p"},"ALL")," policies on that bucket."))}u.isMDXComponent=!0}}]);