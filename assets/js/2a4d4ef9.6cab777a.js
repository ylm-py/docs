"use strict";(self.webpackChunkcontabo_docs=self.webpackChunkcontabo_docs||[]).push([[6321],{3905:(e,t,o)=>{o.d(t,{Zo:()=>u,kt:()=>b});var a=o(7294);function r(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function n(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function l(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?n(Object(o),!0).forEach((function(t){r(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function i(e,t){if(null==e)return{};var o,a,r=function(e,t){if(null==e)return{};var o,a,r={},n=Object.keys(e);for(a=0;a<n.length;a++)o=n[a],t.indexOf(o)>=0||(r[o]=e[o]);return r}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(a=0;a<n.length;a++)o=n[a],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),o=t;return e&&(o="function"==typeof e?e(t):l(l({},t),e)),o},u=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var o=e.components,r=e.mdxType,n=e.originalType,s=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),d=p(o),b=r,g=d["".concat(s,".").concat(b)]||d[b]||c[b]||n;return o?a.createElement(g,l(l({ref:t},u),{},{components:o})):a.createElement(g,l({ref:t},u))}));function b(e,t){var o=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var n=o.length,l=new Array(n);l[0]=d;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:r,l[1]=i;for(var p=2;p<n;p++)l[p]=o[p];return a.createElement.apply(null,l)}return a.createElement.apply(null,o)}d.displayName="MDXCreateElement"},3872:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>c,frontMatter:()=>n,metadata:()=>i,toc:()=>p});var a=o(7462),r=(o(7294),o(3905));const n={title:"Control Storage Space",sidebar_position:10},l="Control Storage Space",i={unversionedId:"products/Object-Storage/HowTo/control-storage-space",id:"products/Object-Storage/HowTo/control-storage-space",title:"Control Storage Space",description:"Sometimes you may encounter with S3 compatible Object Storage in general that more storage space is reported as being used than you obviously have. In practice it has the following reasons:",source:"@site/docs/products/Object-Storage/HowTo/control-storage-space.md",sourceDirName:"products/Object-Storage/HowTo",slug:"/products/Object-Storage/HowTo/control-storage-space",permalink:"/docs/products/Object-Storage/HowTo/control-storage-space",draft:!1,editUrl:"https://github.com/contabo/docs/tree/main/docs/products/Object-Storage/HowTo/control-storage-space.md",tags:[],version:"current",sidebarPosition:10,frontMatter:{title:"Control Storage Space",sidebar_position:10},sidebar:"productSidebar",previous:{title:"Migrate to Contabo Object Storage",permalink:"/docs/products/Object-Storage/HowTo/migrate-to-contabo-object-storage"},next:{title:"Setup Custom Domain",permalink:"/docs/products/Object-Storage/HowTo/custom-domain"}},s={},p=[{value:"Aborted multipart uploads",id:"aborted-multipart-uploads",level:2},{value:"Display multipart uploads",id:"display-multipart-uploads",level:3},{value:"Aborting / Deleting multipart uploads",id:"aborting--deleting-multipart-uploads",level:3},{value:"Aborting all multipart uploads of a bucket",id:"aborting-all-multipart-uploads-of-a-bucket",level:3},{value:"Enabled Versioning",id:"enabled-versioning",level:2},{value:"Delete an old version of a file",id:"delete-an-old-version-of-a-file",level:3}],u={toc:p};function c(e){let{components:t,...o}=e;return(0,r.kt)("wrapper",(0,a.Z)({},u,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"control-storage-space"},"Control Storage Space"),(0,r.kt)("p",null,"Sometimes you may encounter with S3 compatible Object Storage in general that more storage space is reported as being used than you obviously have. In practice it has the following reasons:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#aborted-multipart-uploads"},"Aborted multipart uploads")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#enabled-versioning"},"Enabled Versioning"))),(0,r.kt)("p",null,"The next sections will cover the different topics in more detail. In the following we assume ",(0,r.kt)("a",{parentName:"p",href:"/docs/products/Object-Storage/Tools/aws-cli"},"aws cli")," to be installed and configured properly."),(0,r.kt)("h2",{id:"aborted-multipart-uploads"},"Aborted multipart uploads"),(0,r.kt)("p",null,"Usually uploads of larger files are chunked into smaller pieces e.g. 10 MB and uploaded one by one. Those pieces of files are not shown by default but of course occupy storage space. Multipart uploads are managed by buckets."),(0,r.kt)("h3",{id:"display-multipart-uploads"},"Display multipart uploads"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"aws --profile eu2 --region default --endpoint-url https://eu2.contabostorage.com s3api list-multipart-uploads --bucket mybucket\n")),(0,r.kt)("p",null,"This will return a JSON output containing files currently being uploaded or having been aborted. If you get nothing back then there are no multipart uploads going on."),(0,r.kt)("h3",{id:"aborting--deleting-multipart-uploads"},"Aborting / Deleting multipart uploads"),(0,r.kt)("p",null,"In order to abort a single upload please copy the key (file name) and the upload id and invoke, e.g."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"aws --profile eu2 --region default --endpoint-url https://eu2.contabostorage.com s3api abort-multipart-upload --bucket mybucket --key filename.ext --upload-id 2~Pw5t8pu1uBnxu_qMyJRnjnZKYvav41c\n")),(0,r.kt)("h3",{id:"aborting-all-multipart-uploads-of-a-bucket"},"Aborting all multipart uploads of a bucket"),(0,r.kt)("p",null,"The following script automates the process of deleting every multipart upload in progress or which has been aborted."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'BUCKETNAME=mybucket\naws --profile eu2 --region default --endpoint-url https://eu2.contabostorage.com s3api list-multipart-uploads --bucket $BUCKETNAME \\\n| jq -r \'.Uploads[] | "--key \\"\\(.Key)\\" --upload-id \\(.UploadId)"\' \\\n| while read -r param; do\n    eval "aws --profile eu2 --region default --endpoint-url https://eu2.contabostorage.com s3api abort-multipart-upload --bucket $BUCKETNAME $param";\ndone\n')),(0,r.kt)("h2",{id:"enabled-versioning"},"Enabled Versioning"),(0,r.kt)("p",null,"Enabled or once enabled Versioning holds also storage space as there are many versions of a file. Those files are usually not visible."),(0,r.kt)("p",null,"Please refer to ",(0,r.kt)("a",{parentName:"p",href:"/docs/products/Object-Storage/HowTo/versioning"},"Versioning")," for how to enable and disable it. In the following we will just handle the deletion of older versions to reclaim storage space."),(0,r.kt)("h3",{id:"delete-an-old-version-of-a-file"},"Delete an old version of a file"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"aws --profile eu2 --region default --endpoint-url https://eu2.contabostorage.com s3api list-object-versions --bucket mybucket\naws --profile eu2 --region default --endpoint-url https://eu2.contabostorage.com s3api delete-object --bucket mybucket --key file-to-delete.ext --version-id 3424sadfds2344\n")),(0,r.kt)("admonition",{title:"Hint",type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Tools like ",(0,r.kt)("a",{parentName:"p",href:"/docs/products/Object-Storage/Tools/cyberduck"},"Cyberduck")," are making these tasks very easy. Just do a ",(0,r.kt)("inlineCode",{parentName:"p"},"Info")," on a bucket and check ",(0,r.kt)("inlineCode",{parentName:"p"},"Bucket Versioning"),". Please also enable via ",(0,r.kt)("inlineCode",{parentName:"p"},"View")," -> ",(0,r.kt)("inlineCode",{parentName:"p"},"Show Hidden Files")," the display of all versions. You might also delete older versions very easily.")))}c.isMDXComponent=!0}}]);